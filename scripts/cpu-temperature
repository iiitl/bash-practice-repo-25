#!/usr/bin/env bash

grep -E 'Tctl|Tdie|Package id' /sys/class/hwmon/hwmon*/temp*_label | head -n1 | cut -d':' -f1 | sed 's/label/input/' | xargs cat

# Following script outputs current cpu die temperature in milidegree-celcius, convert it to celcius and fahrenheit and display as:
#
# Celcius: 42.0 C
# Fahrenheit: 107.6 F
cpu_temp_milli_celsius=$(grep -E 'Tctl|Tdie|Package id' /sys/class/hwmon/hwmon*/temp*_label | head -n1 | cut -d':' -f1 | sed 's/label/input/' | xargs cat)

# Check if the temperature was successfully retrieved
if [ -z "$cpu_temp_milli_celsius" ]; then
  echo "Error: Unable to read CPU temperature. Ensure your system exposes the temperature data."
  exit 1
fi

# Convert the temperature from millidegrees Celsius to regular Celsius
cpu_temp_celsius=$(echo "scale=1; $cpu_temp_milli_celsius / 1000" | bc)

# Convert the temperature from Celsius to Fahrenheit
cpu_temp_fahrenheit=$(echo "scale=1; ($cpu_temp_celsius * 9 / 5) + 32" | bc)

# Output the temperature in both Celsius and Fahrenheit
echo "Current CPU temperature:"
echo "Celsius: $cpu_temp_celsius°C"
echo "Fahrenheit: $cpu_temp_fahrenheit°F"